<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Quick Unlock — SuperEdu</title>

<link rel="stylesheet" href="/assets/css/main.css">
<script src="/assets/js/menu.js" defer></script>
<script src="/assets/js/lang.js" defer></script>

<style>
body {
  font-family: Inter, Arial, sans-serif;
  background: #FAF5E9;
  margin: 0;
}

.form-wrap {
  max-width: 520px;
  margin: 140px auto 60px;
  background: #ffffffdd;
  padding: 32px;
  border-radius: 16px;
  box-shadow: 0 8px 26px rgba(0,0,0,0.12);
}

h1 {
  text-align: center;
  margin-top: 0;
  margin-bottom: 20px;
  font-size: 32px;
  font-weight: 700;
  color: #2C9C47;
}

label {
  display: block;
  margin-top: 16px;
  font-size: 15px;
  color: #444;
}

input {
  width: 100%;
  height: 42px;
  padding: 8px 12px;
  margin-top: 6px;
  border-radius: 8px;
  border: 1px solid #ccc;
  font-size: 15px;
}

button {
  width: 100%;
  margin-top: 26px;
}

.success-msg, .error-msg {
  margin-top: 14px;
  text-align: center;
  font-size: 15px;
}

.success-msg { color: #2C9C47; }
.error-msg { color: #d33; }
</style>
</head>

<body>

<!-- Top Navigation (保持与你网站一致) -->
<nav id="topNav" class="nav--transparent">
  <div class="nav-inner">
    <div class="brand">
      <a href="/index.html#home">
        <img src="/assets/img/superedu-logo.png" class="logo-img" />
        <span class="brand-text">SuperEdu</span>
      </a>
    </div>

    <div class="menu" id="menu">
      <a href="/index.html#home" data-en="Home" data-zh="首页">Home</a>
      <a href="/membership.html" data-en="Membership" data-zh="会员">Membership</a>
      <a href="/membership.html" data-en="EduCenter" data-zh="教育中心">EduCenter</a>
      <a href="/membership.html" data-en="EduCommunity" data-zh="教育社区">EduCommunity</a>
      <span class="nav-underline"></span>
    </div>

    <div class="nav-right">
      <button id="langToggle" class="lang-toggle">中文</button>
      <button id="hamburger" class="hamburger"><span></span><span></span><span></span></button>
    </div>
  </div>
</nav>

<!-- Main Content -->
<div class="form-wrap">

  <h1 data-en="Quick Unlock" data-zh="快速解锁">Quick Unlock</h1>

  <form id="unlockForm">
    <label data-en="First Name" data-zh="名">First Name</label>
    <input type="text" id="firstName" required>

    <label data-en="Last Name" data-zh="姓">Last Name</label>
    <input type="text" id="lastName" required>

    <label data-en="Email" data-zh="邮箱">Email</label>
    <input type="email" id="email" required>

    <button type="submit" class="btn btn-primary" 
      data-en="Submit" data-zh="提交">Submit</button>
  </form>

  <div class="success-msg" id="successMsg"></div>
  <div class="error-msg" id="errorMsg"></div>
</div>

<script>
document.getElementById("unlockForm").addEventListener("submit", async function(e) {
  e.preventDefault();
  
  const firstName = document.getElementById("firstName").value.trim();
  const lastName = document.getElementById("lastName").value.trim();
  const email = document.getElementById("email").value.trim();

  // Email format check
  const emailPattern = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
  if(!emailPattern.test(email)){
    showError("Invalid email format");
    return;
  }

  const payload = { firstName, lastName, email };

  try {
    const res = await fetch("/api/unlock", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(payload)
    });

    const data = await res.json();

    if (res.ok && data.success) {
      // Save soft-login token
      localStorage.setItem("unlockToken", data.token);

      showSuccess("Unlocked successfully!");

      // Redirect after short delay
      setTimeout(() => {
        window.location.href = "/educenter.html";  
      }, 800);

    } else {
      showError(data.error || "Failed to submit");
    }

  } catch (err) {
    showError(err.message);
  }
});

function showSuccess(msg){
  document.getElementById("successMsg").textContent = msg;
  document.getElementById("errorMsg").textContent = "";
}

function showError(msg){
  document.getElementById("errorMsg").textContent = msg;
  document.getElementById("successMsg").textContent = "";
}
</script>

</body>
</html>

