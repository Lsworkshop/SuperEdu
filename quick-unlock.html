<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Quick Unlock – Membership Access</title>

<style>
/* ------------------------------
   Global + Navigation (Same as index.html)
--------------------------------*/
body {
  margin: 0;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
  background: #fafafa;
}

/* Nav Container */
.navbar {
  width: 100%;
  padding: 18px 40px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  background: white;
  border-bottom: 1px solid #eee;
  position: sticky;
  top: 0;
  z-index: 50;
}

/* Logo */
.nav-left img {
  height: 42px;
}

/* Desktop Menu */
.nav-center {
  display: flex;
  gap: 32px;
}

.nav-center a {
  text-decoration: none;
  color: #333;
  font-size: 16px;
  padding-bottom: 6px;
  position: relative;
}

/* Hover underline */
.nav-center a::after {
  content: "";
  height: 2px;
  width: 0%;
  background: #333;
  position: absolute;
  left: 0;
  bottom: 0;
  transition: 0.25s ease;
}

.nav-center a:hover::after {
  width: 100%;
}

/* Language Button */
.lang-btn {
  cursor: pointer;
  padding: 6px 14px;
  border-radius: 6px;
  border: 1px solid #ccc;
  background: white;
  font-size: 14px;
}

/* Mobile menu button */
.menu-btn {
  display: none;
  cursor: pointer;
  font-size: 24px;
}

/* ------------------------------
   Mobile Menu
--------------------------------*/
@media (max-width: 820px) {
  .nav-center {
    display: none;
  }
  .menu-btn {
    display: block;
  }

  .mobile-menu {
    position: absolute;
    width: 100%;
    left: 0;
    top: 70px;
    background: white;
    display: none;
    flex-direction: column;
    padding: 20px 0;
    border-bottom: 1px solid #eee;
    z-index: 40;
  }

  .mobile-menu a {
    padding: 14px 20px;
    text-decoration: none;
    color: #333;
    font-size: 17px;
  }
}

/* ------------------------------
    Quick Unlock Page Layout
--------------------------------*/
.main {
  max-width: 600px;
  margin: 60px auto;
  background: white;
  padding: 40px;
  border-radius: 14px;
  border: 1px solid #eee;
  box-shadow: 0 6px 20px rgba(0,0,0,0.06);
}

h1 {
  margin-top: 0;
  font-size: 28px;
  color: #111;
}

label {
  display: block;
  margin-top: 20px;
  font-size: 15px;
  color: #333;
}

input {
  width: 100%;
  margin-top: 8px;
  padding: 14px;
  font-size: 16px;
  border: 1px solid #ccc;
  border-radius: 8px;
}

button {
  margin-top: 25px;
  width: 100%;
  padding: 14px;
  background: black;
  color: white;
  border: none;
  font-size: 17px;
  border-radius: 10px;
  cursor: pointer;
}

button:hover {
  background: #333;
}

.success-message {
  margin-top: 20px;
  font-size: 16px;
  color: green;
  display: none;
}
.error-message {
  margin-top: 20px;
  font-size: 16px;
  color: red;
  display: none;
}

</style>
</head>
<body>

<!-- ============================================================
     Navigation Bar (FULL COPY FROM index.html)
=============================================================== -->
<nav class="navbar">
  <div class="nav-left">
    <a href="/"><img src="/assets/logo.png" alt="Logo"></a>
  </div>

  <div class="nav-center">
    <a href="/">Home</a>
    <a href="/membership.html">Membership</a>
    <a href="/edu-center.html">EduCenter</a>
    <a href="/community.html">EduCommunity</a>
  </div>

  <button class="lang-btn" id="langToggle">EN</button>

  <div class="menu-btn" id="menuBtn">☰</div>
</nav>

<div class="mobile-menu" id="mobileMenu">
  <a href="/">Home</a>
  <a href="/membership.html">Membership</a>
  <a href="/edu-center.html">EduCenter</a>
  <a href="/community.html">EduCommunity</a>
</div>

<!-- ============================================================
     Quick Unlock Content
=============================================================== -->

<div class="main">
  <h1>Quick Unlock Access</h1>
  <p>Enter your information to unlock Level-1 membership access.</p>

  <label>First Name</label>
  <input id="firstName" type="text">

  <label>Last Name</label>
  <input id="lastName" type="text">

  <label>Email</label>
  <input id="email" type="email">

  <button onclick="submitUnlock()">Unlock Now</button>

  <div class="success-message" id="successMsg">Unlocked successfully! Redirecting…</div>
  <div class="error-message" id="errorMsg"></div>
</div>

<script>
/* -----------------------------------------------------
   Mobile Menu Toggle
------------------------------------------------------ */
const menuBtn = document.getElementById("menuBtn");
const mobileMenu = document.getElementById("mobileMenu");

menuBtn.onclick = () => {
  mobileMenu.style.display =
    mobileMenu.style.display === "flex" ? "none" : "flex";
};

/* -----------------------------------------------------
   Language toggle (placeholder)
------------------------------------------------------ */
document.getElementById("langToggle").onclick = () => {
  alert("Language switching coming soon.");
};

/* -----------------------------------------------------
   MAIN FUNCTION — Quick Unlock
------------------------------------------------------ */
async function submitUnlock() {
  const firstName = document.getElementById("firstName").value.trim();
  const lastName = document.getElementById("lastName").value.trim();
  const email = document.getElementById("email").value.trim();

  const err = document.getElementById("errorMsg");
  const ok = document.getElementById("successMsg");

  err.style.display = "none";
  ok.style.display = "none";

  if (!firstName || !lastName || !email) {
    err.innerText = "All fields are required.";
    err.style.display = "block";
    return;
  }

  /* -----------------------------------------------------
     STEP 1 — Check if email already has unlock
     (Level-1 permission check)
  ------------------------------------------------------ */
  const check = await fetch("/api/check-auth", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ email })
  }).then(r => r.json());

  if (check.exists === true) {
    // Already unlocked → Give token
    localStorage.setItem("membership_token", check.token);
    ok.innerText = "Already unlocked! Redirecting…";
    ok.style.display = "block";
    return setTimeout(() => location.href = "/membership.html", 1200);
  }

  /* -----------------------------------------------------
     STEP 2 — Perform Unlock
  ------------------------------------------------------ */
  const res = await fetch("/api/unlock", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ firstName, lastName, email })
  }).then(r => r.json());

  if (res.error) {
    err.innerText = res.error;
    err.style.display = "block";
    return;
  }

  /* -----------------------------------------------------
     STEP 3 — Store local token
  ------------------------------------------------------ */
  const token = "level1_" + btoa(email) + "_" + Date.now();
  localStorage.setItem("membership_token", token);

  ok.innerText = "Unlocked successfully! Redirecting…";
  ok.style.display = "block";

  setTimeout(() => location.href = "/membership.html", 1300);
}

</script>

</body>
</html>
