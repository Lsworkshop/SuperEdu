<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Quick Unlock — SuperEdu</title>

  <!-- icons (same as index.html) -->
  <link rel="apple-touch-icon" sizes="180x180" href="/assets/icons/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/assets/icons/favicon-32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/assets/icons/favicon-16.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/assets/icons/android-chrome-192.png">
  <link rel="icon" type="image/png" sizes="512x512" href="/assets/icons/android-chrome-512.png">
  <link rel="icon" href="/assets/icons/favicon.ico">

  <!-- main site CSS (keeps consistent styling) -->
  <link rel="stylesheet" href="/assets/css/main.css">

  <!-- ensure menu + lang behavior same as other pages -->
  <script src="/assets/js/menu.js" defer></script>
  <script src="/assets/js/lang.js" defer></script>

  <style>
    /* small page-specific tweaks to match visual style */
    .page-wrap { max-width: 980px; margin: 110px auto 60px; padding: 0 20px; }
    .quick-card { padding: 22px; border-radius: 12px; box-shadow: 0 8px 26px rgba(9,30,66,0.04); background: linear-gradient(180deg,#fff,#FAF5E9); border:1px solid rgba(10,10,10,0.03); }
    .quick-title { font-size: 26px; margin: 0 0 6px; color: var(--brand-2); font-weight:700; }
    .quick-desc { color: var(--muted); margin-bottom:18px; }

    /* form layout — use registration-card styles if present */
    .quick-form label { display:block; font-size:13px; margin-top:12px; }
    .quick-form input[type="text"], .quick-form input[type="email"] {
      width:100%; padding:12px; border-radius:8px; border:1px solid #e8e8e8; margin-top:6px; font-size:15px;
    }

    .form-actions{ display:flex; gap:12px; align-items:center; margin-top:16px; flex-wrap:wrap; }
    .status { font-size:14px; color:var(--muted); }

    .enter-btn { display:none; }

    /* small responsive */
    @media (max-width:720px){
      .page-wrap{ margin-top:80px; }
    }
  </style>
</head>
<body>

<!-- NAV -->

<nav id="topNav" class="nav--transparent">
  <div class="nav-inner">

    <!-- Logo -->
    <div class="brand">
      <a href="/index.html#home" class="brand">
        <img src="/assets/img/superedu-logo.png" alt="Edunova" class="logo-img" />
        <span class="brand-text">Edunova</span>
      </a>
    </div>

    <!-- =========================
         Desktop Menu
    ========================== -->
    <div class="menu" id="menu">

      <!-- Home -->
      <a href="/index.html#home" data-en="Home" data-zh="首页">Home</a>

      <!-- About -->
      <a href="/index.html#about" data-en="About" data-zh="关于我们">About</a>

    <!-- Programs Dropdown -->
<div class="nav-item dropdown">

  <span class="dropdown-toggle"
        role="button"
        aria-haspopup="true"
        tabindex="0"
        data-en="Programs ⬇︎"
        data-zh="项目 ⬇︎"> 
  </span> 

  <div class="dropdown-menu">
    <a href="/education.html"
       id="navEduCenter"
       data-en="EduCenter"
       data-zh="教育中心">
      EduCenter
    </a>

    <a href="/community.html"
       id="navEduCommunity"
       data-en="EduCommunity"
       data-zh="教育社区">
      EduCommunity
    </a>

    <a href="/forum.html"
       id="navForum"
       data-en="EduForum"
       data-zh="教育论坛">
      EduForum 
    </a>

    <a href="/events.html" data-en="Events" data-zh="活动"> Events</a>
    
  </div>

</div>

      <!-- Services -->
      <a href="/index.html#services" data-en="Services" data-zh="服务">Services</a>

      <!-- Membership -->
     <a href="/membership.html" id="navMembership" data-en="Membership" data-zh="会员中心">Membership</a>

      <!-- Get Involved Dropdown -->
<div class="nav-item dropdown">
  <span class="dropdown-toggle" role="button" aria-haspopup="true" tabindex="0"
        data-en="Get Involved ⬇︎" data-zh="参与方式 ⬇︎">
   
</span>

  <div class="dropdown-menu">
    <a href="/volunteer.html"
       data-en="Volunteer"
       data-zh="志愿者">
      Volunteer
    </a>

    <a href="/donation.html"
       data-en="Donation"
       data-zh="捐赠">
      Donation
    </a>

    <a href="/index.html#resources"
       data-en="Resources"
       data-zh="资源">
      Resources
    </a>
  </div>
</div>

      <!-- Contact -->
      <a href="/index.html#contact" data-en="Contact" data-zh="联系">Contact</a>

      <!-- Login -->
     <a href="/login.html" id="desktopAuth" data-en="Login" data-zh="登录">Login</a>

      <!-- Slide underline -->
      <span class="nav-underline"></span>
    </div>

    <!-- Right side -->
    <div class="nav-right">
      <button id="langToggle" class="lang-toggle" aria-label="Language toggle">
        中文
      </button>

      <button id="hamburger" class="hamburger" aria-label="Menu">
        <span></span><span></span><span></span>
      </button>
    </div>
  </div>

  <!-- Mobile slide menu -->
  <div id="mobileMenu" class="mobile-menu" aria-hidden="true">
    <!-- Home -->
    <a href="/index.html#home" data-en="Home" data-zh="首页">Home</a>

    <!-- About -->
    <a href="/index.html#about" data-en="About" data-zh="关于我们">About</a>

    <!-- Programs Accordion -->
    <details class="mobile-group">
      <summary data-en="Programs" data-zh="项目">Programs</summary>
      <a href="/education.html" id="mobileEduCenter" data-en="EduCenter" data-zh="教育中心">EduCenter</a>
      <a href="/community.html" id="mobileEduCommunity" data-en="EduCommunity" data-zh="教育社区">EduCommunity</a>
      <a href="/forum.html" id="mobileForum" data-en="EduForum" data-zh="教育论坛">EduForum</a>
      <a href="/events.html" data-en="Events" data-zh="活动">Events</a>
    </details>

    <!-- Service -->
    <a href="/index.html#services" data-en="Service" data-zh="服务">Service</a>

    <!-- Membership -->
    <a href="/membership.html" id="mobileMembership" data-en="Membership" data-zh="会员中心">Membership</a>

    <!-- Get Involved Accordion -->
    <details class="mobile-group">
      <summary data-en="Get Involved" data-zh="参与方式">Get Involved</summary>
      <a href="/volunteer.html" data-en="Volunteer" data-zh="志愿者">Volunteer</a>
      <a href="/donation.html" data-en="Donation" data-zh="捐赠">Donation</a>
      <a href="/index.html#resources" data-en="Resources" data-zh="资源">Resources</a>
    </details>

    <!-- Contact -->
    <a href="/index.html#contact" data-en="Contact" data-zh="联系">Contact</a>

    <!-- Login -->
    <a href="/login.html" id="mobileAuth" data-en="Login" data-zh="登录">Login</a>

    <!-- Mobile action buttons -->
    <div class="mobile-actions">
      <button class="btn btn-ghost" id="mobileRegister" data-en="Register/Join" data-zh="注册/加入">
        Register / Join
      </button>
      <button class="btn" id="mobileUnlock" data-en="Unlock Education" data-zh="解锁教育">
        Unlock Education
      </button>
    </div>
  </div>
</nav> 

  <!-- PAGE CONTENT -->
  <div class="page-wrap">
    <div class="card quick-card quick-unlock-card">
      <div class="card-inner">
        <h2 class="quick-title" data-en="Quick Unlock" data-zh="快速解锁">Quick Unlock</h2>
        <div class="quick-desc" data-en="Enter your name and email to unlock access to the Education Center." data-zh="请输入姓名与邮箱以解锁教育中心访问权限。">
          Enter your name and email to unlock access to the Education Center.
        </div>

        <form id="quickUnlockForm" class="quick-form" autocomplete="off">
          <label for="q-first" data-en="First name" data-zh="名">First name</label>
          <input id="q-first" name="firstName" type="text" required placeholder="e.g. John / 例如：小明" />

          <label for="q-last" data-en="Last name" data-zh="姓">Last name</label>
          <input id="q-last" name="lastName" type="text" required placeholder="e.g. Smith / 例如：张" />

          <label for="q-email" data-en="Email" data-zh="邮箱">Email</label>
          <input id="q-email" name="email" type="email" required placeholder="you@domain.com / 您的邮箱" />

          <div class="form-actions">
            <button type="submit" id="unlockSubmit" class="btn btn-primary" data-en="Unlock" data-zh="解锁">Unlock</button>
            <button type="button" id="enterEduBtn" class="btn btn-outline enter-btn" data-en="Enter Education Center" data-zh="进入教育中心">Enter Education Center</button>
            <div id="quickStatus" class="status"></div>
          </div>
        </form>

        <p class="small muted" style="margin-top:12px" data-en="Unlocks are recorded by email and stored for access checks." data-zh="解锁将根据邮箱记录并用于访问验证。">Unlocks are recorded by email and stored for access checks.</p>
      </div>
    </div>
  </div>

  <!-- Inline JS: form handling + token set (keeps behavior same as index) -->
  <script>
    // keep same email pattern as backend
    const emailPattern = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;

    // Elements
    const form = document.getElementById('quickUnlockForm');
    const statusEl = document.getElementById('quickStatus');
    const enterBtn = document.getElementById('enterEduBtn');

    // If token exists, show Enter button
    function checkLocalToken(){
      const t = JSON.parse(localStorage.getItem('edu_unlocked_token') || 'null');
      if(t && t.email){
        enterBtn.style.display = 'inline-block';
      } else {
        enterBtn.style.display = 'none';
      }
    }
    checkLocalToken();

    // Enter Education Center behaviour
    enterBtn?.addEventListener('click', ()=>{
      const token = JSON.parse(localStorage.getItem('edu_unlocked_token') || 'null');
      if(!token){ alert(localStorage.getItem('superedu-lang')==='zh' ? '请先解锁教育中心' : 'Please unlock access first'); return; }
      window.location = '/education.html';
    });

    // Form submit
    form?.addEventListener('submit', async function(e){
      e.preventDefault();
      statusEl.style.color = ''; statusEl.innerText = '';

      const firstName = document.getElementById('q-first').value.trim();
      const lastName = document.getElementById('q-last').value.trim();
      const email = document.getElementById('q-email').value.trim();

      if(!firstName || !lastName || !email){
        statusEl.style.color = 'crimson';
        statusEl.innerText = localStorage.getItem('superedu-lang')==='zh' ? '请填写所有必填项' : 'Please fill all required fields';
        return;
      }
      if(!emailPattern.test(email)){
        statusEl.style.color = 'crimson';
        statusEl.innerText = localStorage.getItem('superedu-lang')==='zh' ? '请输入有效邮箱' : 'Please enter a valid email';
        return;
      }

      statusEl.style.color = ''; statusEl.innerText = localStorage.getItem('superedu-lang')==='zh' ? '提交中...' : 'Submitting...';

      try {
        // 1) Optional: check-auth to see if already unlocked (if you have this API)
        let already = false;
        try {
          const chk = await fetch('/api/check-auth', {
            method:'POST', headers:{'Content-Type':'application/json'},
            body: JSON.stringify({ email })
          });
          if(chk.ok){
            const j = await chk.json();
            if(j.exists) {
              already = true;
              // set local token if backend returns one
              const token = j.token || JSON.stringify({ email, ts: Date.now() });
              localStorage.setItem('edu_unlocked_token', JSON.stringify({ email, ts: Date.now() }));
              localStorage.setItem("snovaRole", "quick");
              statusEl.style.color = 'green';
              statusEl.innerText = localStorage.getItem('superedu-lang')==='zh' ? '已解锁 — 您现在可以进入教育中心' : 'Already unlocked — you may enter the Education Center';
              enterBtn.style.display = 'inline-block';
            }
          }
        } catch(err){
          // ignore — check-auth is optional
          // console.warn('check-auth failed', err);
        }

        if(already) return;

        // 2) call /api/unlock to persist
        const res = await fetch('/api/unlock', {
          method:'POST', headers:{'Content-Type':'application/json'},
          body: JSON.stringify({ firstName, lastName, email })
        });

        const out = await res.json();

        if(!res.ok){
          statusEl.style.color = 'crimson';
          statusEl.innerText = out.error || out.message || (localStorage.getItem('superedu-lang')==='zh' ? '提交失败' : 'Submission failed');
          return;
        }

        // success -> set token locally
        localStorage.setItem('edu_unlocked_token', JSON.stringify({ email, ts: Date.now() }));
        localStorage.setItem("snovaRole", "quick");

        statusEl.style.color = 'green';
        statusEl.innerText = localStorage.getItem('superedu-lang')==='zh' ? '解锁成功！正在跳转…' : 'Unlocked — redirecting…';
        enterBtn.style.display = 'inline-block';

        // small delay then go to Education Center
        setTimeout(()=> window.location.assign('/education.html'), 900);
      } catch(err){
        console.error(err);
        statusEl.style.color = 'crimson';
        statusEl.innerText = localStorage.getItem('superedu-lang')==='zh' ? '提交失败，请重试' : 'Submission failed — please try again';
      }
    });

    // ensure mobile menu buttons that exist behave same as homepage
    document.getElementById('mobileRegister')?.addEventListener('click', ()=> location.href = '/membership.html');
    document.getElementById('mobileUnlock')?.addEventListener('click', ()=> { /* we're already on quick-unlock */ });

    // ensure nav underline/menu highlight handled in CSS/JS elsewhere (menu.js)
  </script>
</body>
</html>

