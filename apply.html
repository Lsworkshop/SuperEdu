<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Apply for Services — SuperEdu</title>
<style>
  :root{--brand-gold:#D8B04C;--brand-green:#2C9C47;--bg:#FAF5E9;--text:#333;}
  body{margin:0;font-family:Inter,Arial,sans-serif;background:var(--bg);color:var(--text);-webkit-font-smoothing:antialiased;}
  .container{max-width:820px;margin:28px auto;padding:16px;}
  .card{background:#fff;padding:18px;border-radius:12px;box-shadow:0 6px 18px rgba(0,0,0,0.06);border:1px solid rgba(0,0,0,0.03);}
  h1{margin:0 0 8px;color:var(--brand-green)}
  label{display:block;margin-top:10px;font-size:14px}
  input,select,textarea{width:100%;padding:10px;border-radius:8px;border:1px solid #e8e8e8;margin-top:6px}
  .btn{background:var(--brand-green);color:#fff;padding:12px 14px;border-radius:10px;border:none;margin-top:12px;cursor:pointer;font-weight:700}
  .small{font-size:13px;color:#7a7a7a;margin-top:8px}
  .services-grid{display:grid;grid-template-columns:1fr;gap:8px;margin-top:8px}
  @media(min-width:800px){.services-grid{grid-template-columns:repeat(2,1fr)}}
</style>
</head>
<body>
<div class="container">
  <div class="card">
    <h1 data-en="Service Application" data-zh="服务申请">Service Application</h1>
    <p class="small" data-en="Please provide your details and select the services you are interested in." data-zh="请输入您的信息并选择您感兴趣的服务。">Please provide your details and select the services you are interested in.</p>

    <form id="applyForm">
      <label for="firstName" data-en="First name" data-zh="名">First name</label>
      <input id="firstName" name="firstName" required />

      <label for="lastName" data-en="Last name" data-zh="姓">Last name</label>
      <input id="lastName" name="lastName" required />

      <label for="email" data-en="Email" data-zh="邮箱">Email</label>
      <input id="email" name="email" type="email" required />

      <label for="phone" data-en="Phone (optional)" data-zh="电话（可选）">Phone (optional)</label>
      <input id="phone" name="phone" />

      <label for="country" data-en="Country / Region" data-zh="国家 / 地区">Country / Region</label>
      <input id="country" name="country" />

      <label data-en="Select service(s) of interest" data-zh="选择感兴趣的服务">Select service(s) of interest</label>
      <div class="services-grid" id="servicesList">
        <!-- 10 services checkboxes populated by JS to ensure exact wording -->
      </div>

      <label for="notes" data-en="Additional notes (optional)" data-zh="附加说明（可选）">Additional notes (optional)</label>
      <textarea id="notes" name="notes" rows="4"></textarea>

      <div style="display:flex;gap:10px;align-items:center">
        <button type="submit" class="btn" id="submitBtn" data-en="Submit Application" data-zh="提交申请">Submit Application</button>
        <div id="formStatus" class="small"></div>
      </div>
    </form>
  </div>
</div>

<script>
/* language */
const LANG_KEY = 'superedu-lang';
let lang = localStorage.getItem(LANG_KEY) || 'en';
const serviceItems = [
  {id:'s1', en:'U.S. Education & Comparative Analysis', zh:'美国教育体系与比较分析'},
  {id:'s2', en:'College Application Strategy & Planning', zh:'大学申请策略与规划'},
  {id:'s3', en:'Pre-College Profile Development (AP/Summer Programs)', zh:'大学前背景打造（AP/夏校）'},
  {id:'s4', en:'Financial Aid (FAFSA/CSS) — One-on-One', zh:'助学金（FAFSA/CSS）一对一辅导'},
  {id:'s5', en:'Scholarship Application Support', zh:'奖学金申请辅导'},
  {id:'s6', en:'Family & Long-term Education Planning', zh:'家庭与长期教育规划'},
  {id:'s7', en:'Education Savings & Tax (ESA / 529)', zh:'教育储蓄与税务（ESA / 529）'},
  {id:'s8', en:'College Fund Design & Financial Strategy', zh:'大学基金设计与资金策略'},
  {id:'s9', en:'Family Foundation / 501(c)(3) Setup', zh:'家庭基金会 / 501(c)(3) 设立辅导'},
  {id:'s10', en:'Education + Wealth & Trust Planning', zh:'教育与财富信托规划'}
];

function renderServices(){
  const wrap = document.getElementById('servicesList');
  wrap.innerHTML = '';
  serviceItems.forEach(s=>{
    const id = 'chk_'+s.id;
    const div = document.createElement('div');
    div.innerHTML = `<label style="display:flex;gap:8px;align-items:center"><input type="checkbox" id="${id}" name="services" value="${s.en}"><span class="label-text" data-en="${s.en}" data-zh="${s.zh}">${lang==='en'?s.en:s.zh}</span></label>`;
    wrap.appendChild(div);
  });
}
renderServices();

/* initialize language on labels/buttons */
function setLang(l){
  lang = l; localStorage.setItem(LANG_KEY,l);
  document.querySelectorAll('[data-en]').forEach(el=>{
    if(el.tagName === 'INPUT' || el.tagName === 'TEXTAREA') return;
    el.innerText = (l==='en')?el.getAttribute('data-en'):el.getAttribute('data-zh');
  });
  // re-render services to ensure correct label text
  renderServices();
  document.getElementById('submitBtn').innerText = (l==='en')?'Submit Application':'提交申请';
}
setLang(lang);

/* form submit -> /api/apply */
document.getElementById('applyForm').addEventListener('submit', async function(e){
  e.preventDefault();
  const status = document.getElementById('formStatus');
  status.innerText = (lang==='en') ? 'Submitting...' : '提交中...';
  const services = Array.from(document.querySelectorAll('input[name="services"]:checked')).map(i=>i.value);
  const payload = {
    firstName: document.getElementById('firstName').value.trim(),
    lastName: document.getElementById('lastName').value.trim(),
    email: document.getElementById('email').value.trim(),
    phone: document.getElementById('phone').value.trim(),
    country: document.getElementById('country').value.trim(),
    services,
    notes: document.getElementById('notes').value.trim(),
    lang,
    source:'apply_form',
    created_at: new Date().toISOString()
  };
  try{
    const res = await fetch('/api/apply', {method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(payload)});
    const j = await res.json();
    if(res.ok){
      // redirect to thank you page
      window.location.href = '/thank-you.html';
    } else {
      status.innerText = j.message || ((lang==='en')?'Submission failed':'提交失败');
    }
  }catch(err){
    console.error(err);
    status.innerText = (lang==='en')?'Submission failed':'提交失败';
  }
});
</script>
</body>
</html>
